# Задача - реализовать консольные утилиты.

Проверка задач осуществляется некоторым конвейером, через который проходят лог файлы работы перловых скриптов.
На выходе получаем статистику по варнингам, находящимся в этих лог файлах:
- с разбивкой по модулям и частоте их встреч в разных файлах
- топ модулей в которых происходят ошибки.

Результатом проверки является сравнение STDOUT скрипта, написанного студентами, и стандартного скрипта из coretils.
Исключением являются скрипты, написанные преподавателями.
Если md5(STDOUT) не совпадает, то проверяется есть ли загруженная утилита diff/comm.
Если есть, то делает diff эталонного файла и файла, который получился после работы скрипта студента.
Если вывод совпадает с выводом консольного скрипта, то `head` от `diff`'а отдаётся студентам для справки, что не понравилось в результате работы.

## Список задач

### show
Утилита, которая принимает на вход список файлов, а аргументом принимает shell-маску файлов. Открывает по очереди файлы, которые попадают под маску, и выводит их в STDOUT, добавляя к началу каждой строки имя файла через двоеточие:

Пример:
```sh
$ ls -1
info.txt
show.pl
test.pl
$ ls -1 | show '*.pl'
show.pl:#!/us/bin/env perl
show.pl:
show.pl:use strict;
...
test.pl:#!/us/bin/env perl
test.pl:use 5.016;
...
```

Шелл-паттерн определяется следующими символами:
- `*` - обозначает любое количество любых символов
- `?` - обозначает один любой символ
- `{`...`}` - обозначает перечисление нескольких паттернов, через `,`

Пример:
```
show '?*.{info,warn,deb*}.log'
```

Дополнительные параметры на дополнительные баллы:

- `-d|--delimiter` - изменить разделитель со стандартного `:`
- `-n|--numbers` - выводить дополнительно колонку с номером строки
- `-P|--pattern` - использовать PCRE паттерн вместо shell-pattern'а

### tf
Необходимо написать утилиту, которая будет фильтровать входящий поток по времени, время начала и завершения интервала передаются в параметрах запуска.
По умолчанию утилита должна находить в строке первую от начала дату в формате `YYYY-MM-DD HH::MM:SS` (`%Y-%m-%d %H:%M:%S`).

Обязательные параметры:

- `-f|--from=X` - время начала интервала (unix timestamp)
- `-t|--to=X` - время завершения интервала (unix timestamp)

Unix timestamp для произвольной даты вы можете получить при помощи утилиты `date -d`

Необязательные параметры:
- `--time=FORMAT` - формат времени который нужно искать в файле в формате strptime (по умолчанию `%Y-%m-%d %H:%M:%S`)

Скрипт на вход получает набор строк, из них оставляет только те, в которых находится дата опредлённого формата попадающая в указанный интервал

Пример:
```
$ cat data
aaa sss dd 2017-10-18 11:10:01 sdjkafkjsdhfsdka sadjkhfsl df lkshjdaflkh
askdjhfkljshad fklajhsdf lakjs  aslkjdfh asdflkjhasd flkjh
eee ashjfgaskjf ask 2017-10-18 15:15:15 kjdshklsfdhf aslkjfh asflksahf 
asfdjhsg asdfjkh 2017-10-18 20:20:20 sdfjhskadjfh askljdhf aslkfjdh
jdsfkjh asdfkjlh asdflkhj alsdf lkjahsdf lkasjhdf

$ cat data | ./bin/tf --from=1508224400 --to=1508342400
aaa sss dd 2017-10-18 11:10:01 sdjkafkjsdhfsdka sadjkhfsl df lkshjdaflkh
eee ashjfgaskjf ask 2017-10-18 15:15:15 kjdshklsfdhf aslkjfh asflksahf 
```

### replace
Необходимо написать утилиту, которая реализует замену строк входящего потока на определённый шаблон.
 
Обязательные параметры:

- `-p|--pattern=X` - регулярное выражения с захватами, которое выбирает нужные данные из строки 
- `-r|--replace=X` - шаблон в который превращается входящая строка с плейсхолдерами $\d

Пример:
```
$ cat data
aaa   :a0e7f64b:bbb:Bla bla bla
aaa1  :f041a04c:bbb1:Bla bla bla1
aaa234:8710afe3:bbb2:Bla bla bla2

$ cat data | bin/replace -p '\s*:([a-f0-9]+):[^:]+:(.*)' -r 'Name: $2\tId: $1'
Name: Bla bla bla	Id: a0e7f64b
Name: Bla bla bla1	Id: f041a04c
Name: Bla bla bla2	Id: 8710afe3
```

### group_by

Необходимо реализовать программу которая принимает на стандартный ввод текст и обрабатывает его в соответствии с заданными опциями командной строки.

Обязательные параметры:

- `-k|--key=X` - Задаёт номер колонки по которой выполняется агрегация (обязательный параметр)
- `-l|--limit=X` - Для каждого уникального значения из колонки `--key` вывести первые `X` указанных строк

Дополнительные параметры на дополнительные баллы:

- `--count` - Для каждого ключа вывести количество сколько раз он встречается
- `--max=X` - Для каждого ключа вывести максимальное значение из столбца `X`
- `--min=X` - Для каждого ключа вывести минимальное значение из столбца `X`
- `--sum=X` - Для каждого ключа вывести сумму значения из столбца `X`
- `--avg=X` - Для каждого ключа вывести среднее значение из столбца `X`

Примеры:

```sh
$ cat data
Once    1       2       3       4
Twice   2       3       4       5
Twice   3       4       5       6

$ cat data | group_by --key 1 --limit 1
Once    1       2       3       4
Twice   2       3       4       5

$ cat data | group_by --key 1 --count --avg=3
Key   COUNT AVG
Once  1     2
Twice 2     3.5

$ cat data | group_by --key 1 --limit 1 --count --max=2 --min=3 --sum=4 --avg=5
Once    1       2       3       4
Twice   2       3       4       5

Key   COUNT MAX MIN SUM AVG
Once  1     1   2   3   4
Twice 2     3   3   9   5.5
```

---

### head

Необходимо реализовать программу которая принимает на стандартный ввод текст и выводит на стандартный вывод X строк, количество которых задается опцией -n командной строки. Если опция -n не указана, выводит первые 10 строк.

Параметр:
- `-n|--lines=X` - Задаёт количество первых X строк текста, которые необходимо вывести.

Дополнительно:

- `-n|--lines=-X` - Вывести все строки, кроме X последних.

Пример:
```
[au@au ~]$ ls -l ~/
итого 5286592
-rw-r--r--.   1 au   au   2819711364 сен 10  2015 00000000002143390282.snap
-rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
-rw-rw-r--.   1 au   au           12 июн  8  2016 1
-rw-rw-r--.   1 au   au        75362 сен  5  2014 10615518_715583841840066_707896928196214409_n.jpg?oh=1326040d2404c8e1f2826efedd0a074f&oe=57DB4168
-rw-rw-r--    1 au   au       252928 июл  7 12:34 11_1436865411.xls
-rw-rw-r--    1 au   au       265021 апр 24 21:53 123.PDF
-rw-rw-r--    1 au   au       128910 ноя 25  2016 141_1982839_img7025944450870293062.jpg
-rw-rw-r--    1 au   au      9947452 фев 17  2017 16.02.17.mp4
-rw-rw-r--    1 au   au      3092484 фев 13  2017 16733911_750669768420391_2300330977035026432_n.mp4
-rwxr-xr-x.   1 au   au      5183866 июл  1  2014 1.gif
-rw-rw-r--    1 au   au          765 окт  3 19:14 1.txt
-rw-rw-r--    1 au   au       387910 авг  9 11:37 2001.jpeg
-rw-------    1 au   au       388877 июл  3 15:14 2001.pdf
-rwxr-xr-x.   1 au   au       117952 мар 15  2012 2012-03-15 17.57.08.jpg

[au@au ~]$ ls -l ~/|head
итого 5286592
-rw-r--r--.   1 au   au   2819711364 сен 10  2015 00000000002143390282.snap
-rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
-rw-rw-r--.   1 au   au           12 июн  8  2016 1
-rw-rw-r--.   1 au   au        75362 сен  5  2014 10615518_715583841840066_707896928196214409_n.jpg?oh=1326040d2404c8e1f2826efedd0a074f&oe=57DB4168
-rw-rw-r--    1 au   au       252928 июл  7 12:34 11_1436865411.xls
-rw-rw-r--    1 au   au       265021 апр 24 21:53 123.PDF
-rw-rw-r--    1 au   au       128910 ноя 25  2016 141_1982839_img7025944450870293062.jpg
-rw-rw-r--    1 au   au      9947452 фев 17  2017 16.02.17.mp4
-rw-rw-r--    1 au   au      3092484 фев 13  2017 16733911_750669768420391_2300330977035026432_n.mp4

[au@au ~]$ ls -l ~/|head -n 2
итого 5286548
-rw-r--r--.   1 au   au   2819711364 сен 10  2015 00000000002143390282.snap

[au@au ~]$ ls -l ~/|head -n -10
итого 5286548
-rw-r--r--.   1 au   au   2819711364 сен 10  2015 00000000002143390282.snap
-rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
-rw-rw-r--.   1 au   au           12 июн  8  2016 1
-rw-rw-r--.   1 au   au        75362 сен  5  2014 
```

---

### cut

Утилита, которая принимает входной поток, разбивает его на колонки по разделителю `TAB` и вырезает из него заданные (`man cut`)

Обязательные параметры:

- `-f` - "fields" - выбрать поля (колонки)
- `-d` - "delimiter" - использовать другой разделитель

Опционально:

* `-s` - "separated" - выводить только строки с разделителем

Пример:
```sh
$ echo -ne "1\t2\t3\n4\t5\t6\n7\t8\t9\n"
1   2   3
4   5   6
7   8   9

$ echo -ne "1\t2\t3\n4\t5\t6\n7\t8\t9\n" | cut -f 2,3
2   3
5   6
8   9

$ echo -ne "1:2:3\n4:5:6\n7:8:9\n" | cut -f 3 -d:
3
6
9
```

---

### sort

Написать утилиту sort

```sh
$ echo -ne '2 b\n3 a\n3 b\n100 b\n4 b' | sort -k 2 -k 1 -n
3 a
2 b
3 b
4 b
100 b
```

Обязательные параметры:

- `-k` — указание колонки для сортировки. Поддержать возможность указать несколько ключей для сортировки по двум и более колонкам
- `-n` — сортировать по числовому значению. Если значение в колонке не число — сортировать как строки
- `-r` — сортировать в обратном порядке

Дополнительные параметры на дополнительные баллы:

- `-t` — разделитель колонок вместо пробелов
- `-f` — игнорировать регистр
- `-i` — игнорировать символы не входящие в базовый ASCII-набор (латиница, цифры, знаки препинания)

---

### grep

Написать утилиту grep

```sh
$ seq 1 10 | grep -P -o '[1-3]'
1
2
3
1
```

Обязательные параметры:

- `-i` — игнорировать регистр
- `-o` — выводить только ту часть что совпала с регулярным выражением
- `-P` — принимать и игнорировать

Дополнительные параметры на дополнительные баллы:

- `-b` — выводить перед каждым совпадением смещение в байтах от начала входных данных
- `-w` — выбирать только строки которые шаблон в которых целиком захватывает слова (не попадает на границу слова)
- `-x` — выбирать только строки целиком состоящие из заданного шаблона

---

### diff

Необходимо реализовать программу которая показывает различия двух файлов.
Программа принимает на вход в качестве аргументов имена 2-х сравниваемых файлов.
На выход печатает различия в этих файлах, в формате:
`<номера строк первого файла><a - добавлено, с - изменено, d - удалено><номера строк второго файла>`

Каждая строка, которая была добавлена, удалена или изменена, предваряется угловыми скобками.

`<` - строка из первого файла

`>` - строка из второго файла

Блоки изменений разделяются через `---`


Пример:
```
[au@au ~]$ cat 1.txt 
итого 5286548
-rw-r--r--.   1 au   au   2819711364 сен 10  2015 00000000002143390282.snap
-rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
-rw-rw-r--.   1 au   au           12 июн  8  2016 1
-rw-rw-r--.   1 au   au        75362 сен  5  2014 10615518_715583841840066_707896928196214409_n.jpg?oh=1326040d2404c8e1f2826efedd0a074f&oe=57DB4168
-rw-rw-r--    1 au   au       252928 июл  7 12:34 11_1436865411.xls
-rw-rw-r--    1 au   au       265021 апр 24 21:53 123.PDF
-rw-rw-r--    1 au   au       128910 ноя 25  2016 141_1982839_img7025944450870293062.jpg
-rw-rw-r--    1 au   au      9947452 фев 17  2017 16.02.17.mp4
-rw-rw-r--    1 au   au      3092484 фев 13  2017 16733911_750669768420391_2300330977035026432_n.mp4
-rwxr-xr-x.   1 au   au      5183866 июл  1  2014 1.gif
-rw-rw-r--    1 au   au          765 окт  3 19:14 1.txt
-rw-rw-r--    1 au   au       387910 авг  9 11:37 2001.jpeg
-rw-------    1 au   au       388877 июл  3 15:14 2001.pdf
-rwxr-xr-x.   1 au   au       117952 мар 15  2012 2012-03-15 17.57.08.jpg

[au@au ~]$ cat 2.txt 
-rw-r--r--.   1 au   au   2819711364 сен 10  2015 00000000002143390282.snap
-rw-rw-r--.   1 au   au           12 июн  8  2016 1
-rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
-rw-rw-r--.   1 au   au        75362 сен  5  2014 10615518_715583841840066_707896928196214409_n.jpg?oh=1326040d2404c8e1f2826efedd0a074f&oe=57DB4168
итого 5286548

[au@au ~]$ diff 1.txt 2.txt 
1d0
< итого 5286548
3d1
< -rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
4a3
> -rw-rw-r--    1 au   au        60780 ноя 24  2016 0006-a-27.jpg
6,15c5
< -rw-rw-r--    1 au   au       252928 июл  7 12:34 11_1436865411.xls
< -rw-rw-r--    1 au   au       265021 апр 24 21:53 123.PDF
< -rw-rw-r--    1 au   au       128910 ноя 25  2016 141_1982839_img7025944450870293062.jpg
< -rw-rw-r--    1 au   au      9947452 фев 17  2017 16.02.17.mp4
< -rw-rw-r--    1 au   au      3092484 фев 13  2017 16733911_750669768420391_2300330977035026432_n.mp4
< -rwxr-xr-x.   1 au   au      5183866 июл  1  2014 1.gif
< -rw-rw-r--    1 au   au          765 окт  3 19:14 1.txt
< -rw-rw-r--    1 au   au       387910 авг  9 11:37 2001.jpeg
< -rw-------    1 au   au       388877 июл  3 15:14 2001.pdf
< -rwxr-xr-x.   1 au   au       117952 мар 15  2012 2012-03-15 17.57.08.jpg
---
> итого 5286548

```

---

### uniq

Утилита, объединяющая последовательные одинаковые строки

Обязательные опции:

- `-c` - посчитать количество повторений и вывести перед строкой

Дополнительные опции
- `-d` - выводить только повторяющиеся строки
- `-f` - пропускать первые N полей при сравнении
- `-i` - игнорировать регистр
- `-u` - выводить только уникальные строки

```sh
$ echo -ne "a\na\na\nb\nb\nc\n"
a
a
a
b
b
c

$ echo -ne "a\na\na\nb\nb\nc\n"  | uniq
a
b
c

$ echo -ne "a\na\na\nb\nb\nc\n"  | uniq -c
      3 a
      2 b
      1 c
```
